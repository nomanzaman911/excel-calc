<!DOCTYPE html>

<!-- saved from url=(0062)file:///C:/Users/363ra/Downloads/solar_racking_form_final.html -->
<html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Solar Racking Details Form</title>
<script src="./Solar Racking Details Form_files/saved_resource"></script>
<style>
    body {
      background-color: #f5f7fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .main-layout {
      display: flex;
      justify-content: flex-start;
      gap: 24px;
      max-width: 1800px;
      margin: 0 auto;
      padding: 32px;
    }
    .container {
      flex: 3.3;
    }
    .side-container {
      align-self: flex-start;
      margin-top: 0;
      flex: 1;
      background-color: #ffffff;
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
    }
    .group-box {
      background-color: #ffffff;
      padding: 20px;
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
    }
    .group-title {
      font-size: 16px;
      font-weight: 600;
      color: #1e3a5f;
      margin-bottom: 12px;
    }
    .label {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 15px;
      color: #003355;
      display: block;
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      border: 1px solid #b8c3d0;
      background-color: #ffffff;
      font-size: 14px;
    }
    .address-row {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }
    .address-row input {
      flex: 1;
    }
    .address-row button {
      padding: 0 12px;
      background-color: #2563eb;
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .roof-height-row {
      display: flex;
      gap: 10px;
    }
    .roof-height-row select,
    .roof-height-row input {
      flex: 1;
      margin-bottom: 0;
    }
    .inline-field {
      display: flex;
      gap: 10px;
    }
    .inline-field .field {
      flex: 1;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      word-wrap: break-word;
    }
    th {
      font-weight: normal;
      color: #1e3a5f;
    }
    td input[type="number"], td input[type="text"], td select {
      width: 100%;
      text-align: center;
    }
  </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.mb-4{margin-bottom:1rem}</style></head>
<body>
<div class="main-layout">
<div class="container">
<label class="label">Project Location</label>
<div class="address-row">
<input data-cell="B1" id="input1" required="" type="text"/>
<button>Search</button>
</div>
<div class="form-grid">
<div class="group-box">
<div class="group-title">Building &amp; Panel Dimensions</div>
<div class="inline-field">
<div class="field"><label class="label">Building Width (b) (m)</label><input data-cell="C11" id="input2" step="0.01" type="number" value="500"/></div>
<div class="field"><label class="label">Building Depth (d) (m)</label><input data-cell="E11" id="input3" step="0.01" type="number" value="500"/></div>
</div>
<label class="label">Roof height (m) and type</label>
<div class="roof-height-row">
<select data-cell="G11" id="input4">
<option>h - Mean roof height</option>
<option>hmin - Min roof height</option>
<option>hmax - Max roof height</option>
</select>
<input data-cell="J11" id="input5" step="0.01" type="number" value="10"/>
</div>
<div class="inline-field">
<div class="field"><label class="label">Panel width (mm)</label><input data-cell="K6" id="input6" step="0.01" type="number" value="1000"/></div>
<div class="field"><label class="label">Panel length (mm)</label><input data-cell="K7" id="input7" step="0.01" type="number" value="2000"/></div>
</div>
<label class="label">Panel Weight (kg)</label><input data-cell="K8" id="input8" step="0.01" type="number" value="25"/>
</div>
<div class="group-box">
<div class="group-title">Roof Details</div>
<label class="label">Roof Shape</label>
<select data-cell="A11" id="input9"><option>Flat</option><option>Gable</option><option>Hip</option><option>Mono-slope</option><option>Cantilever</option><option>Open</option></select>
<label class="label">Roof slope (Â°)</label><input data-cell="A13" id="input10" step="1" type="number" value="3"/>
<label class="label">Roof Material Type</label>
<select data-cell="A12" id="input11"><option>Steel</option><option>Timber</option><option>Concrete</option></select>
<label class="label">Max. Purlin/Battens Spacing (mm)</label><input data-cell="A15" id="input12" step="1" type="number" value="1200"/>
<label class="label">Parapet Height (mm)</label><input data-cell="A25" id="input13" step="1" type="number" value="0"/>
<label class="label">No. of Panels in a Group</label><input data-cell="A28" id="input14" step="1" type="number" value="1"/>
<label class="label">ASCE 7-22 SECTION 29.4.3 - TILT (FLAT, GABLE &amp; HIP ROOFS ONLY WITH PITCH &lt; 7Â°)</label>
<select data-cell="L32" id="input15">
<option>
        Yes
       </option>
<option>
        No
       </option>
</select>
<label class="label">Parapet Height (mm) (ASCE 7-22)</label><input data-cell="E37" id="parapetHeight" step="1" type="number" value="0"/>
<label class="label">No. of Panels in a Group (ASCE 7-22)</label><input data-cell="A34" id="panelCount" step="1" type="number" value="1"/>
</div>
<div class="group-box">
<div class="group-title">
       Mounting System Details
      </div>
<label class="label">
       Installation Type
      </label>
<select data-cell="A6" id="input16" onchange="toggleTiltAngle()">
<option value="A">
        A-Flush Mount - Rails Perp to Purlins
       </option>
<option value="B">
        B-Flush Mount - Rails Directly over Purlins
       </option>
<option value="C">
        C-Tilt - Rails Perp to Purlins
       </option>
<option value="D">
        D-Tilt - Rails Directly over Purlins
       </option>
</select>
<div id="tiltAngleField" style="display:none;">
<label class="label">
        Tilt Angle (Â°)
       </label>
<input data-cell="CELL_17" id="input17" step="1" type="number"/>
</div>
<label class="label">
       Fasteners
      </label>
<select data-cell="G6" id="input18">
<option>
        01-Kliplok High Strength EMU
       </option>
<option>
        02-Kliplok Classic EMU
       </option>
<option>
        03-SingleFix Pro
       </option>
<option>
        04-TrimFix EMU
       </option>
<option>
        05-KingFix EMU
       </option>
<option>
        06-FixW-1876 Corrugated EMU
       </option>
<option>
        07-Longline Seam Clamps 503 AL EMU
       </option>
<option>
        10-RapidPro L
       </option>
<option>
        11-RapidPro L - Use Configuration B
       </option>
<option>
        12-RapidÂ²+ Pro SML
       </option>
<option>
        13-Klicktop
       </option>
</select>
<label class="label">
       Zoning Method
      </label>
<select data-cell="E6" id="input19">
<option>
        3-Zone Method
       </option>
<option>
        4-Zone Method
       </option>
</select>
<label class="label">
       Minimum Zone Size (m)
      </label>
<input data-cell="G15" id="input20" step="1" type="number" value="0"/>
<label class="label">
       Shading Distance (mm)
      </label>
<input data-cell="H15" id="input21" step="1" type="number" value="0"/>
<label class="label">
       On-purlin solution?
      </label>
<select data-cell="C15" id="input22">
<option>
        Yes
       </option>
<option>
        No
       </option>
</select>
<label class="label">
       Off-purlin solution?
      </label>
<select data-cell="E15" id="input23">
<option>
        Yes
       </option>
<option>
        No
       </option>
</select>
</div>
<div class="group-box">
<div class="group-title">Wind Parameters</div>
<label class="label">Importance Level</label>
<select data-cell="A18" id="input24"><option>1</option><option>2</option><option>3</option></select>
<label class="label">Design Life</label>
<select data-cell="C18" id="designLife"><option>Temp. Works</option><option>5 years</option><option>25 years</option><option>50 years</option><option>100 years or more</option></select>
<label class="label">Region</label>
<select data-cell="E18" id="input25"><option>A0</option><option>A1</option><option>A2</option><option>A3</option></select>
<label class="label">Ultimate Wind Pressure from Checkwind (kPa)</label><input data-cell="I22" id="input26" step="0.01" type="number" value="0.6"/>
<label class="label">Ground Snow Load Sg (kPa)</label><input data-cell="K18" id="input27" step="0.01" type="number" value="0"/>
<label class="label">Terrain Category Range</label>
<input data-cell="K22" id="input28" step="0.01" type="number" value="2"/> <label class="label">To</label> <input data-cell="M22" id="input29" step="0.01" type="number" value="3"/>
</div>
<div class="group-box" style="grid-column: span 4;">
<div class="group-title">On-Purlin Solution</div>
<table>
<thead>
<tr>
<th>Roof Zones</th>
<th>Net Wind Pressure - Ultimate (kPa)</th>
<th>Net Wind Pressure - Service (kPa)</th>
<th style="width: 240px;">Ultimate Reactions (kN)</th>
<th style="width: 90px;">No. of Rails</th>
<th>Rail Type</th>
<th>Calculated Spacing (mm)</th>
</tr>
</thead>
<tbody>
<tr>
<td data-cell="O5" id="output1">-</td>
<td data-cell="P5" id="output2">0</td>
<td data-cell="Q5" id="output3">0</td>
<td data-cell="R5" id="output4">0</td>
<td><input data-cell="V5" id="input30" type="number" value="2"/></td>
<td><select data-cell="W5" id="input31"><option>35</option><option>50</option></select></td>
<td data-cell="X5" id="output5">0</td>
</tr>
<tr>
<td data-cell="O6" id="output6">-</td>
<td data-cell="P6" id="output7">0</td>
<td data-cell="Q6" id="output8">0</td>
<td data-cell="R6" id="output9">0</td>
<td><input data-cell="V6" id="input32" type="number" value="2"/></td>
<td><select data-cell="W6" id="input33"><option>35</option><option>50</option></select></td>
<td data-cell="X6" id="output10">0</td>
</tr>
<tr>
<td data-cell="O7" id="output11">-</td>
<td data-cell="P7" id="output12">0</td>
<td data-cell="Q7" id="output13">0</td>
<td data-cell="R7" id="output14">0</td>
<td><input data-cell="V7" id="input34" type="number" value="2"/></td>
<td><select data-cell="W7" id="input35"><option>35</option><option>50</option></select></td>
<td data-cell="X7" id="output15">0</td>
</tr>
<tr>
<td data-cell="O8" id="output16">-</td>
<td data-cell="P8" id="output17">0</td>
<td data-cell="Q8" id="output18">0</td>
<td data-cell="R8" id="output19">0</td>
<td><input data-cell="V8" id="input36" type="number" value="2"/></td>
<td><select data-cell="W8" id="input37"><option>35</option><option>50</option></select></td>
<td data-cell="X8" id="output20">0</td>
</tr>
</tbody>
</table>
</div>
<div class="group-box" style="grid-column: span 4;">
<div class="group-title">Off-Purlin Solution</div>
<table>
<thead>
<tr>
<th>Roof Zones</th>
<th>Net Wind Pressure - Ultimate (kPa)</th>
<th>Net Wind Pressure - Service (kPa)</th>
<th style="width: 240px;">Ultimate Reactions (kN)</th>
<th>Rail Type</th>
<th>Calculated Spacing (mm)</th>
</tr>
</thead>
<tbody>
<tr>
<td data-cell="O16" id="output21">-</td>
<td data-cell="P16" id="output22">0</td>
<td data-cell="Q16" id="output23">0</td>
<td data-cell="R16" id="output24">0</td>
<td><select data-cell="V16" id="input38"><option>35</option><option>50</option></select></td>
<td data-cell="X16" id="output25">0</td>
</tr>
<tr>
<td data-cell="O17" id="output26">-</td>
<td data-cell="P17" id="output27">0</td>
<td data-cell="Q17" id="output28">0</td>
<td data-cell="R17" id="output29">0</td>
<td><select data-cell="V17" id="input39"><option>35</option><option>50</option></select></td>
<td data-cell="X17" id="output30">0</td>
</tr>
<tr>
<td data-cell="O18" id="output31">-</td>
<td data-cell="P18" id="output32">0</td>
<td data-cell="Q18" id="output33">0</td>
<td data-cell="R18" id="output34">0</td>
<td><select data-cell="V18" id="input40"><option>35</option><option>50</option></select></td>
<td data-cell="X18" id="output35">0</td>
</tr>
<tr>
<td data-cell="O19" id="output36">-</td>
<td data-cell="P19" id="output37">0</td>
<td data-cell="Q19" id="output38">0</td>
<td data-cell="R19" id="output39">0</td>
<td><select data-cell="V19" id="input41"><option>35</option><option>50</option></select></td>
<td data-cell="X19" id="output40">0</td>
</tr>
</tbody>
</table>
</div>
<div class="group-box" style="grid-column: span 4;">
<div class="group-title">Corner Zone Dimension 'a'     20000 formula</div>
<table>
<thead>
<tr>
<th>Zone</th>
<th>From</th>
<th>To</th>
<th style="width: 240px;">(Range)</th>
<th style="width: 90px;">WIND UP (Ïa)</th>
<th style="width: 90px;">WIND UP (fu up)</th>
<th style="width: 90px;">WIND UP (-Wu)</th>
<th style="width: 90px;">WIND DOWN (Cp,e dn)</th>
<th style="width: 90px;">WIND DOWN (fu dn)</th>
<th style="width: 90px;">WIND DOWN (+Wu)</th>
<th style="width: 90px;">WIND DOWN (+Ws)</th>
<th style="width: 90px;">Range</th>
</tr>
</thead>
<tbody>
<tr>
<td data-cell="O26" id="output41">-</td>
<td data-cell="P26" id="output42">0</td>
<td data-cell="Q26" id="output43">0</td>
<td data-cell="R26" id="output44">0</td>
<td data-cell="V26" id="output45">0</td>
<td data-cell="W26" id="output46">0</td>
<td data-cell="X26" id="output47">0</td>
<td data-cell="Z26" id="output48">0</td>
<td data-cell="AA26" id="output49">0</td>
<td data-cell="AB26" id="output50">0</td>
<td data-cell="AC26" id="output51">0</td>
<td data-cell="AD26" id="output52">0</td>
</tr>
<tr>
<td data-cell="O27" id="output53">-</td>
<td data-cell="P27" id="output54">0</td>
<td data-cell="Q27" id="output55">0</td>
<td data-cell="R27" id="output56">0</td>
<td data-cell="V27" id="output57">0</td>
<td data-cell="W27" id="output58">0</td>
<td data-cell="X27" id="output59">0</td>
<td data-cell="Z27" id="output60">0</td>
<td data-cell="AA27" id="output61">0</td>
<td data-cell="AB27" id="output62">0</td>
<td data-cell="AC27" id="output63">0</td>
<td data-cell="AD27" id="output64">0</td>
</tr>
<tr>
<td data-cell="O28" id="output65">-</td>
<td data-cell="P28" id="output66">0</td>
<td data-cell="Q28" id="output67">0</td>
<td data-cell="R28" id="output68">0</td>
<td data-cell="V28" id="output69">0</td>
<td data-cell="W28" id="output70">0</td>
<td data-cell="X28" id="output71">0</td>
<td data-cell="Z28" id="output72">0</td>
<td data-cell="AA28" id="output73">0</td>
<td data-cell="AB28" id="output74">0</td>
<td data-cell="AC28" id="output75">0</td>
<td data-cell="AD28" id="output76">0</td>
</tr>
<tr>
<td data-cell="O29" id="output77">-</td>
<td data-cell="P29" id="output78">0</td>
<td data-cell="Q29" id="output79">0</td>
<td data-cell="R29" id="output80">0</td>
<td data-cell="V29" id="output81">0</td>
<td data-cell="W29" id="output82">0</td>
<td data-cell="X29" id="output83">0</td>
<td data-cell="Z29" id="output84">0</td>
<td data-cell="AA29" id="output85">0</td>
<td data-cell="AB29" id="output86">0</td>
<td data-cell="AC29" id="output87">0</td>
<td data-cell="AD29" id="output88">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="side-container">
<h3 class="group-title mb-4">Information</h3>
<p>This panel can contain notes, links, help text, etc.</p>
</div>
</div>
<script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
<script>
  const msalConfig = {
    auth: {
      clientId: "1140a629-6ea1-41ec-9655-d5e1afab2408",
      authority: "https://login.microsoftonline.com/common",
      redirectUri: window.location.href
    }
  };

  const filePath = "roofmount.xlsx";
  let accessToken = null;
  const msalInstance = new msal.PublicClientApplication(msalConfig);

  async function getAccessToken() {
    try {
      const account = msalInstance.getAllAccounts()[0];
      if (!account) throw new Error("No active session");
      const response = await msalInstance.acquireTokenSilent({
        scopes: ["User.Read", "Files.ReadWrite", "Sites.ReadWrite.All"],
        account
      });
      return response.accessToken;
    } catch (err) {
      console.warn("Silent token failed, trying popup...", err);
      const response = await msalInstance.acquireTokenPopup({
        scopes: ["User.Read", "Files.ReadWrite", "Sites.ReadWrite.All"]
      });
      return response.accessToken;
    }
  }

  async function signIn() {
    try {
      const loginResponse = await msalInstance.loginPopup({
        scopes: ["User.Read", "Files.ReadWrite", "Sites.ReadWrite.All"]
      });
      console.log("â Signed in as", loginResponse.account.username);
      accessToken = await getAccessToken();
      alert("â Signed in successfully!");
    } catch (error) {
      console.error("Sign-in failed:", error);
      alert("â Sign-in failed: " + error.message);
    }
  }

  async function calculate() {
    try {
      accessToken = await getAccessToken();
    } catch (e) {
      alert("â ï¸ Please sign in first.");
      return;
    }

    document.getElementById("loading").style.display = "block";

    const allElements = document.querySelectorAll("[data-cell]");
    const inputs = Array.from(allElements).filter(el => el.tagName === "INPUT" || el.tagName === "SELECT");
    const outputs = Array.from(document.querySelectorAll("td[data-cell]"));

    const values = {};
    inputs.forEach(el => {
      const cell = el.dataset.cell;
      if (cell) {
        values[cell] = el.value;
      }
    });

    for (const [cell, value] of Object.entries(values)) {
      const url = `https://graph.microsoft.com/v1.0/me/drive/root:/${filePath}:/workbook/worksheets('Sheet1')/range(address='${cell}')`;
      await fetch(url, {
        method: "PATCH",
        headers: {
          Authorization: `Bearer ${accessToken}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ values: [[value]] })
      });
    }

    for (const el of outputs) {
      const cell = el.dataset.cell;
      try {
        const res = await fetch(`https://graph.microsoft.com/v1.0/me/drive/root:/${filePath}:/workbook/worksheets('Sheet1')/range(address='${cell}')`, {
          headers: { Authorization: `Bearer ${accessToken}` }
        });
        const data = await res.json();
        if (data?.values?.[0]?.[0] !== undefined) {
          el.textContent = data.values[0][0];
          console.log(`â ${cell} = ${data.values[0][0]}`);
        } else {
          console.warn(`â ï¸ No value returned for ${cell}`);
        }
      } catch (err) {
        console.error(`â Error reading ${cell}:`, err);
      }
    }

    document.getElementById("loading").style.display = "none";
    alert("â Calculation complete!");
  }
</script>
<div style="margin-top: 20px; padding: 10px;">
<button onclick="signIn()" style="padding: 10px 20px; margin-right: 10px;">ð Sign In</button>
<button onclick="calculate()" style="padding: 10px 20px;">ð§® Calculate</button>
</div>
<div id="loading" style="display:none; font-weight: bold; color: blue; padding: 10px;">
  â³ Calculating... Please wait...
</div>
<div class="output-block">
<h3>On-Purlin Solution</h3>
<p id="onPurlinSolution"></p>
</div>
<div class="output-block">
<h3>Off-Purlin Solution</h3>
<p id="offPurlinSolution"></p>
</div>
<div class="output-block">
<h3>20000 Formula Result</h3>
<p id="formula20000"></p>
</div>
<div id="output-area"><div class="output-field" style="margin-top: 15px;"><h4>On-Purlin Solution</h4><p id="excel-output-O2" style="font-weight: bold;">Loading...</p></div><div class="output-field" style="margin-top: 15px;"><h4>Off-Purlin Solution</h4><p id="excel-output-O13" style="font-weight: bold;">Loading...</p></div><div class="output-field" style="margin-top: 15px;"><h4>20000 Formula Result</h4><p id="excel-output-R24" style="font-weight: bold;">Loading...</p></div></div><script id="excel-update-script">
async function updateExtraOutputs(workbook) {

    try {
        const range_O2 = await workbook.worksheets.getItem('Sheet1').getRange('O2').load('values');
        await workbook.context.sync();
        document.getElementById("excel-output-O2").textContent = range_O2.values[0][0];
    } catch (error) {
        console.warn("Failed to load O2: " + error.message);
    }

    try {
        const range_O13 = await workbook.worksheets.getItem('Sheet1').getRange('O13').load('values');
        await workbook.context.sync();
        document.getElementById("excel-output-O13").textContent = range_O13.values[0][0];
    } catch (error) {
        console.warn("Failed to load O13: " + error.message);
    }

    try {
        const range_R24 = await workbook.worksheets.getItem('Sheet1').getRange('R24').load('values');
        await workbook.context.sync();
        document.getElementById("excel-output-R24").textContent = range_R24.values[0][0];
    } catch (error) {
        console.warn("Failed to load R24: " + error.message);
    }
}</script></body></html>
